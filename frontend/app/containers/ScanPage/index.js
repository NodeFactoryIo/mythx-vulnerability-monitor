import { connect } from 'react-redux';
import { compose } from 'redux';
import { createStructuredSelector } from 'reselect';

import injectReducer from 'utils/injectReducer';
import injectSaga from 'utils/injectSaga';
import { makeSelectStep, makeSelectCompilerVersions, makeSelectIsSubmitting } from '../App/selectors';
import { submitContract } from './actions';
import ScanPage from './ScanPage';
import reducer from './reducer';
import saga from './saga';

const mapDispatchToProps = (dispatch) => ({
  onSubmitForm: (contractAddress, name, source, compilerVersion) =>
    dispatch(submitContract(contractAddress, name, source, compilerVersion)),
});

const mapStateToProps = createStructuredSelector({
  step: makeSelectStep(),
  compilerVersions: makeSelectCompilerVersions(),
  isSubmitting: makeSelectIsSubmitting()
});

const withConnect = connect(mapStateToProps, mapDispatchToProps);

const withReducer = injectReducer({ key: 'scan', reducer });
const withSaga = injectSaga({ key: 'scan', saga });

export default compose(withReducer, withSaga, withConnect)(ScanPage);
export { mapDispatchToProps };
