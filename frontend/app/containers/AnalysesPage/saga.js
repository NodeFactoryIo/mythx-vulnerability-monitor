import {
  call, put, takeLatest
} from 'redux-saga/effects';

import { ANALYSES_FETCH_REQUEST, ANALYSES_FETCH_ERROR, ANALYSES_FETCH_SUCCESS } from './constants';
import { getRequest } from '../../utils/request';
import { API_ANALYSES_URL } from '../../api';

function* getAnalyses(action) {
  try {
    const { email } = action;
    const url = API_ANALYSES_URL.replace(':email', email);
    const response = yield call(getRequest, url);

    yield put({ type: ANALYSES_FETCH_SUCCESS, response });
  } catch (err) {
    yield put({ type: ANALYSES_FETCH_ERROR, error: err.response });
  }
}

export default function* analyses() {
  yield takeLatest(ANALYSES_FETCH_REQUEST, getAnalyses);
}
