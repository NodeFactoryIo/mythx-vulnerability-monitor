import {Column, DataType, Model, Table, HasMany, PrimaryKey, CreatedAt, UpdatedAt} from "sequelize-typescript";
import Contract from './Contract';

@Table({
    timestamps: true,
    tableName: "Users",
})
export default class User extends Model<User> {
    @PrimaryKey
    @Column({
        type: DataType.INTEGER,
        autoIncrement: true,
    })
    public id: number;

    @Column({
        type: DataType.STRING,
        unique: true,
        validate: { isEmail: true }
    })
    public email: string;

    @Column({
        type: DataType.TEXT,
    })
    public accessToken: string;

    @Column({
        type: DataType.TEXT,
    })
    public refreshToken: string;

    @CreatedAt
    createdAt: Date;

    @UpdatedAt
    updatedAt: Date;

    @HasMany(() => Contract)
    contracts: Contract[];

    public static findByAccess(access : string) : Promise<User> {
        return User.findOne({
            where: { accessToken: access }
        }) as any;
    }
}
