import { Request, Response } from "express";
import { check, validationResult } from 'express-validator/check';
import User from "../../Models/User";

export default class AnalysisController {

    public static validationGetAnalyses = [
        check('email').exists().trim(),
    ];

    // TODO: This shouldn't be public for everyone, auth needed.
    public static async getAnalyses(req: Request, res: Response): Promise<Response> {
        const errors = validationResult(req);
        if (!errors.isEmpty()) {
            return res.status(400).json({ errors: errors.array() });
        }

        try {
            const { email } = req.query;
            const user = await User.findByEmail(email);

            if (!user) {
                return res.sendStatus(404);
            }

            const contracts = await User.getAllUserAnalyses(user.id);
            return res.status(200).send(contracts);

        } catch (error) {
            console.error(error);
            return res.status(500).send(error);
        }

    }

}
